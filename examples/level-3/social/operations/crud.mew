-- ===========================================================================
-- OPERATIONS: Basic CRUD for Social Network
-- DESCRIPTION: Tests basic operations for the social ontology
-- FEATURES: Core CRUD operations
-- ===========================================================================

-- ---------------------------------------------------------------------------
-- Create: Users
-- ---------------------------------------------------------------------------

--# test_create_user_alice
SPAWN alice: User {
  username = "alice",
  display_name = "Alice Smith",
  bio = "Software developer and open source enthusiast"
}

--# test_create_user_bob
SPAWN bob: User {
  username = "bob_jones",
  display_name = "Bob Jones",
  verified = true
}

--# test_create_user_charlie
SPAWN charlie: User {
  username = "charlie_dev",
  display_name = "Charlie Developer"
}

-- ---------------------------------------------------------------------------
-- Create: Posts
-- ---------------------------------------------------------------------------

--# test_create_public_post
SPAWN pub_post: Post {
  content = "Just launched my new project!",
  visibility = "public"
}
LINK authored(#alice, #pub_post)

--# test_create_friends_post
SPAWN friends_post: Post {
  content = "Private thoughts for friends only",
  visibility = "friends"
}
LINK authored(#alice, #friends_post)

--# test_create_private_post
SPAWN private_post: Post {
  content = "Personal notes",
  visibility = "private"
}
LINK authored(#bob, #private_post)

-- ---------------------------------------------------------------------------
-- Create: Comments
-- ---------------------------------------------------------------------------

--# test_create_comment
SPAWN comment1: Comment {
  content = "Great work!"
}
LINK comment_on(#comment1, #pub_post)
LINK commented_by(#comment1, #bob)

-- ---------------------------------------------------------------------------
-- Create: Groups
-- ---------------------------------------------------------------------------

--# test_create_group
SPAWN devs: Group {
  name = "Developers",
  description = "A group for developers"
}

--# test_join_group
LINK member_of(#alice, #devs) { role = "admin" }
LINK member_of(#bob, #devs)
LINK member_of(#charlie, #devs)

-- ---------------------------------------------------------------------------
-- Create: Relationships
-- ---------------------------------------------------------------------------

--# test_create_friendship
LINK friend_of(#alice, #bob)

--# test_create_follow
LINK follows(#charlie, #alice) {
  notifications_enabled = true
}

--# test_create_block
LINK blocks(#bob, #charlie) {
  reason = "Spam"
}

-- ---------------------------------------------------------------------------
-- Query: Users
-- ---------------------------------------------------------------------------

--# test_query_verified_users
MATCH u: User WHERE u.verified = true
RETURN u.username, u.display_name

--# test_query_users_with_bio
MATCH u: User WHERE u.bio IS NOT NULL
RETURN u.username, u.bio

-- ---------------------------------------------------------------------------
-- Query: Posts by visibility
-- ---------------------------------------------------------------------------

--# test_query_public_posts
MATCH p: Post WHERE p.visibility = "public"
RETURN p.content

--# test_query_posts_by_author
MATCH author: User, p: Post, authored(author, p)
WHERE author.username = "alice"
RETURN p.content, p.visibility

-- ---------------------------------------------------------------------------
-- Query: Social connections
-- ---------------------------------------------------------------------------

--# test_query_alice_friends
MATCH friend_of(#alice, friend)
RETURN friend.username

--# test_query_followers
MATCH follows(follower, #alice)
RETURN follower.username

--# test_query_group_members
MATCH member_of(user, #devs) AS m
RETURN user.username, m.role

-- ---------------------------------------------------------------------------
-- Update: User profile
-- ---------------------------------------------------------------------------

--# test_update_bio
SET #alice { bio = "Updated bio: Open source advocate" }

--# test_verify_update
MATCH u: User WHERE u.username = "alice"
RETURN u.bio

-- ---------------------------------------------------------------------------
-- Update: Post content
-- ---------------------------------------------------------------------------

--# test_edit_post
SET #pub_post {
  content = "Just launched my new project! Edit: Now with more features!",
  edited_at = now()
}

-- ---------------------------------------------------------------------------
-- Cleanup
-- ---------------------------------------------------------------------------

--# test_cleanup_comments
MATCH c: Comment KILL c

--# test_cleanup_posts
MATCH p: Post KILL p

--# test_cleanup_groups
MATCH g: Group KILL g

--# test_cleanup_users
MATCH u: User KILL u
